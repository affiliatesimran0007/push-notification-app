<!DOCTYPE html>
<html lang="en">
<head>
    <!-- PUSH NOTIFICATION INTEGRATION - MUST BE FIRST IN HEAD -->
    <script>
    // Set config first
    window.PUSH_CONFIG = {
        appUrl: 'https://push-notification-app-steel.vercel.app',
        landingId: 'hi-test',
        vapidKey: 'BGv2Vm45eFGslcXFhakD-euIXAnOg6-bdqVWHoSw4gwvjvYYV1zBA_Q7uiNij5yvRqMwmDhpBYYSA1v5Z_GEv_k',
        domain: 'alerts-intuit.com',
        botProtection: true,
        redirects: {
            enabled: true,
            onAllow: 'https://yahoo.com',
            onBlock: 'https://yahoo.com'
        }
    };
    console.log('[Integration] PUSH_CONFIG set:', window.PUSH_CONFIG);
    
    // Add error handling for script load
    window.addEventListener('error', function(e) {
        if (e.filename && e.filename.includes('push-widget.js')) {
            console.error('[Integration] Failed to load push-widget.js:', e.message);
            console.error('Error details:', e);
        }
    }, true);
    </script>
    
    <!-- Load widget with error handling -->
    <script 
        src="https://push-notification-app-steel.vercel.app/js/push-widget.js"
        onerror="console.error('[Integration] Failed to load push-widget.js from:', this.src); 
                 document.getElementById('script-error').style.display='block';
                 document.getElementById('script-error').innerHTML='Failed to load push-widget.js - Check console for details';"
        onload="console.log('[Integration] push-widget.js loaded successfully');">
    </script>
    
    <!-- REST OF HEAD CONTENT -->
    <link rel="manifest" href="/manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Our Website - Debug Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }
        
        #script-error {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #f44336;
            color: white;
            padding: 20px;
            text-align: center;
            z-index: 9999;
            font-weight: bold;
        }
        
        #debug-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-width: 400px;
            z-index: 10000;
        }
        
        #debug-panel h4 {
            margin-bottom: 10px;
            color: #4caf50;
        }
        
        #debug-panel .debug-line {
            margin: 5px 0;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        header {
            background-color: #333;
            color: white;
            padding: 1rem 0;
            text-align: center;
        }
        
        nav {
            background-color: #444;
            padding: 0.5rem;
        }
        
        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
        }
        
        nav ul li {
            margin: 0 1rem;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
        }
        
        nav ul li a:hover {
            text-decoration: underline;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .hero {
            background-color: #f4f4f4;
            padding: 3rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .hero h1 {
            margin-bottom: 1rem;
            font-size: 2.5rem;
        }
        
        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .service-card {
            background-color: #f9f9f9;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .service-card h3 {
            margin-bottom: 1rem;
            color: #333;
        }
        
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div id="script-error"></div>
    
    <div id="debug-panel">
        <h4>Integration Debug Panel</h4>
        <div id="debug-content">
            <div class="debug-line">Initializing...</div>
        </div>
    </div>
    
    <header>
        <h1>Company Name</h1>
        <p>Your tagline goes here</p>
    </header>
    
    <nav>
        <ul>
            <li><a href="#home">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#services">Services</a></li>
            <li><a href="#contact">Contact</a></li>
        </ul>
    </nav>
    
    <div class="hero">
        <div class="container">
            <h1>Welcome to Our Website</h1>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore.</p>
            <button>Get Started</button>
        </div>
    </div>
    
    <div class="container">
        <h2>Our Services</h2>
        <div class="services">
            <div class="service-card">
                <h3>Service One</h3>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus lacinia odio vitae vestibulum.</p>
            </div>
            <div class="service-card">
                <h3>Service Two</h3>
                <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla.</p>
            </div>
            <div class="service-card">
                <h3>Service Three</h3>
                <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim.</p>
            </div>
        </div>
        
        <h2>About Us</h2>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        
        <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    </div>
    
    <footer>
        <p>&copy; 2024 Company Name. All rights reserved.</p>
        <p>123 Main Street, City, State 12345 | Phone: (123) 456-7890</p>
    </footer>
    
    <script>
        // Debug panel updates
        function updateDebug(message, isError = false) {
            const content = document.getElementById('debug-content');
            const line = document.createElement('div');
            line.className = 'debug-line';
            line.style.color = isError ? '#f44336' : '#4caf50';
            line.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            content.appendChild(line);
            
            // Keep only last 10 messages
            while (content.children.length > 10) {
                content.removeChild(content.firstChild);
            }
        }
        
        // Clear initial message
        document.getElementById('debug-content').innerHTML = '';
        
        // Initial checks
        updateDebug('Page loaded');
        updateDebug('PUSH_CONFIG: ' + (window.PUSH_CONFIG ? 'Set' : 'Not set'));
        
        // Check after a delay
        setTimeout(() => {
            updateDebug('Checking widget status...');
            
            if (window.PushWidget) {
                updateDebug('PushWidget: Loaded');
                updateDebug('Subscribed: ' + window.PushWidget.subscribed);
                updateDebug('Overlay shown: ' + window.PushWidget.overlayShown);
            } else {
                updateDebug('PushWidget: NOT LOADED', true);
                updateDebug('Check console for script errors', true);
            }
            
            const overlay = document.getElementById('push-widget-overlay');
            if (overlay) {
                updateDebug('Overlay element: Found');
            } else {
                updateDebug('Overlay element: Not found', true);
            }
            
            // Check localStorage
            const subKeys = Object.keys(localStorage).filter(k => k.startsWith('push-subscribed-'));
            if (subKeys.length > 0) {
                updateDebug('Previous subscriptions: ' + subKeys.join(', '));
                updateDebug('Clear localStorage to test fresh');
            }
        }, 2000);
        
        // Monitor for overlay appearance
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.id === 'push-widget-overlay') {
                        updateDebug('Bot check overlay appeared!');
                    }
                });
            });
        });
        
        observer.observe(document.body, { childList: true, subtree: true });
    </script>
</body>
</html>